/*! Media Fragment URI (spatial dimension) Polyfill - v0.2 - 2013-01-05
 *  Copyright (c) 2013 Fabrice Weinberg (http://fabrice.weinberg.me/)
 */
(function(e){e.fn.uriFragment=function(){var t=/\s*(?!<\")\/\*[^\*]+\*\/(?!\")\s*| |\n|\r/gm,n=/\s*(.*?)\s*\{(.*?)\}/g,r=/(background(?:-image)*):(.*?);/,i=/url\((.*?#.*?)\)/g,s=/(.*?)#xywh=(pixel|percent)*:*(\d+),(\d+),(\d+),(\d+)/,o=!!document.getCSSCanvasContext,u=function(){var e='-moz-image-rect(url(""), 0, 0, 0, 0)',t=document.createElement("div");return t.style.backgroundImage=e,t.style.backgroundImage===e}(),a=0,f=function(e,t,n,r,i,s){a++;var o="poly_img_"+a,u=new Image;return u.onload=function(){if(s){var e=u.width,a=u.height;r=e*r*.01,i=a*i*.01,t=e*t*.01,n=a*n*.01}document.getCSSCanvasContext("2d",o,0,0);var f=document.getCSSCanvasContext("2d",o,r,i);f.drawImage(u,t,n,r,i,0,0,r,i)},u.src=e,"-webkit-canvas("+o+")"},l=function(e){var t=s.exec(e),n="",r,i,a,l,c,h;if(t!==null){r=t[1],i=t[2]!==undefined&&t[2].toLowerCase()==="percent",a=parseInt(t[3],10),l=parseInt(t[4],10),c=parseInt(t[5],10),h=parseInt(t[6],10);if(o)n=f(r,a,l,c,h,i);else if(u){var p=l+h,d=a+c,v=i?"%":"";n="-moz-image-rect(url("+r+"),"+l+v+","+d+v+","+p+v+","+a+v+")"}return[n,a,l,c,h,i]}return null},c=function(e){var s="",o,u;e=e.replace(t,"");while((o=n.exec(e))!==null){var a=o[1],f=o[2];if(f==="")continue;var c=r.exec(f);if(c!==null){var h=c[1],p=c[2],d=p;while((u=i.exec(p))!==null)d=d.replace(u[0],l(u[1])[0]);s+=a+"{"+h+":"+d+" !important}"}}var v=document.createElement("style");v.innerHTML=s,document.head.appendChild(v)},h=function(){e("style").each(function(){e(this).is("link")?e.get(this.href).success(function(e){c(e)}):c(e(this).text())}),e("img").each(function(){var e=this.src,t=l(e);if(t!==null){var n=t[3],r=t[4];t[5]===!0&&(n=this.width*n*.01,r=this.height*r*.01),this.setAttribute("style","display:block;background-image:"+t[0]+";width:"+n+"px;height:"+r+"px;"),this.src=""}})};(o||u)&&h()}})(jQuery),$.fn.uriFragment();