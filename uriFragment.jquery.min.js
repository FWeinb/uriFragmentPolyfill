/*! Media Fragment URI (spatial dimention) Polyfill - v0.1 - 2012-12-15
 *  Copyright (c) 2012 Fabrice Weinberg (http://fabrice.weinberg.me/)
 */
(function(e){e.fn.uriFragment=function(){var t=/\s*(.*?)\s*\{(.*?)\}/g,n=/(background(?:-image)*):(.*?);/,r=/url\((.*?#.*?)\)/g,i=/(.*?)#xywh=(pixel|percent)*:*(\d+),(\d+),(\d+),(\d+)/,s=document.getCSSCanvasContext!==undefined,o=!s,u=0,a=function(e,t,n,r,i,s,o){var u=new Image;u.onload=function(){if(o){var e=u.width,a=u.height;i=e*i*.01,s=a*s*.01,n=e*n*.01,r=a*r*.01}document.getCSSCanvasContext("2d",t,0,0);var f=document.getCSSCanvasContext("2d",t,i,s);f.drawImage(u,n,r,i,s,0,0,i,s)},u.src=e},f=function(e){var t=i.exec(e),n="",r,f,l,c,h,p;if(t!==null){r=t[1],f=t[2]!==undefined&&t[1].toLowerCase()==="percent",l=parseInt(t[3],10),c=parseInt(t[4],10),h=parseInt(t[5],10),p=parseInt(t[6],10);if(s){var d="poly_img_"+u;a(r,d,l,c,h,p,f),n="-webkit-canvas("+d+")",u++}else if(o){var v=c+p,m=l+h,g=f?"%":"";n="-moz-image-rect(url("+r+"),"+c+g+","+m+g+","+v+g+","+l+g+")"}return[n,l,c,h,p,f]}return null},l=function(e){var i="",s,o;e=e.replace(/\s*(?!<\")\/\*[^\*]+\*\/(?!\")\s*/gm,"").replace(/ |\n|\r/g,"");while((s=t.exec(e))!==null){var u=s[1],a=s[2];if(a==="")continue;var l=n.exec(a);if(l!==null){var c=l[1],h=l[2],p=h;while((o=r.exec(h))!==null)p=p.replace(o[0],f(o[1])[0]);i+=u+"{"+c+":"+p+" !important}"}}var d=document.createElement("style");d.innerHTML=i,document.head.appendChild(d)};e("style").each(function(){e(this).is("link")?e.get(this.href).success(function(e){l(e)}):l(e(this).text())}),e("img").each(function(){var e=this.src,t=f(e);if(t!==null){var n=t[5]?"%":"px";this.setAttribute("style","display:block;background-image:"+t[0]+";width:"+t[3]+n+";height:"+t[4]+n+";"),this.src=""}})}})(jQuery),$.fn.uriFragment();